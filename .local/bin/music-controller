#!/usr/bin/env bash

( type -p {"mpd","mpc"}) &> /dev/null || exit 1

# DEFAPPS_EXEC
# CURRENT_MUSICPL="$($DEFAPPS_EXEC -g musicpl)"
CURRENT_MUSICPL="mpd"
if [[ "$CURRENT_MUSICPL" = "mpd" ]]; then
    prev="mpc -q prev"
    toggle="mpc -q toggle"
    stop="mpc -q stop"
    next="mpc -q next"
    status="mpc status"
    title="$(mpc --format '[%title%|%file%]' current)"
else
    prev=""
    toggle=""
    stop=""
    next=""
    status=""
    title="There is no mpd or spotify installed"
fi

case $1 in
    icon)       if [[ "$($status)" = *"laying"* ]]; then
                    echo ""
                else
                    echo ""
                fi
    ;;
    prev)       $($prev)
    ;;
    toggle)     $($toggle)
    ;;
    stop)       $($stop)
    ;;
    next)       $($next)
    ;;
    status)     echo "$($status)"
    ;;
    title)      echo "$title"
    ;;
    switchpl)   [[ "$($status)" = *"laying"* ]] && $($toggle) || :
                if [[ $CURRENT_MUSICPL = "mpd" ]]; then
                    sed -i 's_musicpl=".*"_musicpl="spotify"_' $DEFAPPS_FILE
                fi
                $EXNOTIFY_SEND -u low -i "$NOTIF_MUSIC_ICON" -r 8888 "Music Player" "<span size='small'><u>$($DEFAPPS_EXEC -g musicpl)</u></span>\nSuccessfully set as default"
    ;;
esac
